<!DOCTYPE html>
<html lang="en">

<%- include('./fragments/headFragment.ejs', {stylesheet: 'AssetPage.css'}); -%>

<body>
    <%- include('./fragments/menu/menuFragment.ejs'); -%>
    <%- include('./fragments/notificationFragment.ejs'); -%>
    <h1>Asset page</h1>

    <!-- Rename wallet form -->
    <form action="/wallets/rename" method="POST">
        Rename wallet : <input type="text" name="label" id="">
        <input type="hidden" name="id_wallet" value="<%= id_wallet %>">
        <input type="hidden" name="wallet_id" value="<%= id_wallet %>">
        <input type="submit" value="Rename">
    </form>
    <br />

    <!-- Search an asset based on label form -->
    <form class="searchAsset" method="POST" action="/assets/search">
        <input type="search" name="searchLike">
        <input type="submit" value="Search">
        <input type="hidden" name="wallet_id" value="<%= id_wallet %>">
    </form>

    <div class="asset">

        <!-- List of all the assets in the user's selected wallet -->
        <% for(let i=0 ; i < resultSQL.length ; i++) { %>

            <!-- Specifics details about an asset -->
            <div class="assetCard assetItem">
                <form method="POST" action="/assets/info">
                    <input type="submit" value="X" formaction="/assets/remove">
                    <input type="submit" value="More info">
                    <% let jsonsql = JSON.stringify(resultSQL[i]) %>
                    <input type="hidden" name="assetInfos" value="<%= jsonsql %>">
                    <% if(typeof apiInfos !=='undefined' ) { %>
                        <% let jsonapi = JSON.stringify(apiInfos[resultSQL[i].ticker]) %>
                        <input type="hidden" name="apiInfos" value="<%= jsonapi %>">
                    <% } %>
                    <input type="hidden" name="wallet_id" value="<%= resultSQL[i].id_wallet %>">
                    <p><%= resultSQL[i].label %> <i><small><%= resultSQL[i].ticker %></small></i></p>
                    <p>Quantity : <%= resultSQL[i].quantity %> unités</p>
                    <p>Amount invested : <%= resultSQL[i].invested_amount %> €</p>
                    <% if(typeof apiInfos !=='undefined' ) { %>
                        <p>Current value : <%= (apiInfos[resultSQL[i].ticker].price * resultSQL[i].quantity).toFixed(2) %> €</p>
                    <% } %>
                </form>
            </div>
        <% } %>

        <!-- Add an asset form -->
        <form method="POST" action="/assets/add">
            <div class="addAsset assetItem">
                <select name="asset_id" id="">
                    <% for(let i=0 ; i < assetsFromType.length ; i++) { %>
                        <option value="<%= assetsFromType[i].id %>">
                            <%= assetsFromType[i].label %> (<%= assetsFromType[i].ticker %>)
                        </option>
                    <% } %>
                </select>
                Quantity : <input type="number" name="quantity" id="" step="0.000000001">
                Amount invested : <input type="number" name="invested_amount" id="" step="0.001">
                <input type="hidden" name="wallet_id" value="<%= id_wallet %>">
                <input type="submit" value="+ Add a new asset">
            </div>
        </form>
    </div>
</body>

</html>